<!DOCTYPE html>
<html lang="en">

<head>
    <title>Projeto PPI</title>
    <meta charset="utf-8" />
    <meta name="author" content="Érika Silva e Lucas Freitas" />
    <meta name="description" content="Projeto PPI" />

    <link rel="stylesheet" href="styles.css">
    
</head>

<body>

    <nav>
        <a href="#" onclick="get_jogos()">Listar Jogos</a>
    </nav>
    <div id="insert_jogo">
        <h2>Inserir novo jogo</h2>
        <label for="input_nome">Nome</label>
        <input class="input_insert" id="input_nome" type="text">

        <label for="input_dev">Desenvolvedor</label>
        <input class="input_insert" id="input_dev" type="text">

        <label for="input_categoria">Categoria</label>
        <input class="input_insert" id="input_categoria" type="text">

        <label for="input_img">Url da imagem</label>
        <input class="input_insert" id="input_img" type="text">

        <button onclick="insert_jogo()">Inserir jogo</button>

        <div id="excluir"></div>
        <div id="atualizar"></div>

    </div>
    <div id="principal" class="row">
    </div>

</body>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    function get_jogos() {
        $.ajax({
            type: 'GET',
            url: `http://localhost:3000/jogos`,
            success: function (dados) {
                console.log(dados);
                gerar_card(dados);
            },
            error: function (dados) {
                alert('Erro ao recuperar dados!');
            }
        });
    }
    function gerar_card(dados) {
        let card = $("#principal")
        card.html('');
        for (const dado of dados) {
            card.append(
                `<div class="card green">
                    <img class="image" src="${dado['url_img']}" alt="money" />
                    <h2>${dado['nome']}</h2>
                    <p><strong>Desenvolvedor:</strong> ${dado['dev']} |<strong>Categoria:</strong> ${dado['categoria']}</p>
                </div>
                <button onclick="update_jogo()">atualizar jogo</button>
                <button onclick="delete_jogo()">excluir jogo</button>`
    
                );
               
        }

    }
    function insert_jogo() {
        let get_nome = $('#input_nome');
        let get_dev = $('#input_dev');
        let get_categoria = $('#input_categoria');
        let get_url_img = $('#input_img');
        // console.log(get_nome, get_dev, get_categoria, get_url_img);

        $.ajax({
            type: 'POST',
            url: `http://localhost:3000/jogos/insertJogo`,
            data: JSON.stringify({
                nome: get_nome.val(),
                dev: get_dev.val(),
                categoria: get_categoria.val(),
                url_img: get_url_img.val()

            }),
            success: function (dados) {
                console.log(dados);
                alert(`Jogo inserido com sucesso!`);
                get_jogos();
                get_nome.val('');
                get_dev.val('');
                get_categoria.val('');
                get_url_img.val('');

            },
            error: function (dados) {
                alert('Erro ao inserir jogo! Confira os dados.');
            },
            contentType: 'application/json'
        });
    }

    function update_jogo() {
            $.ajax({
                type: 'POST',
                url: `http://localhost:3000/livros/updatejogo`,
                data: JSON.stringify({
                    titulo: $("#titulo").val(),
                    autor: $("#autor").val(),
                    categoria: $("#categoria").val(),
                    id: $("#id").val()
                }),
                success: function (dados) {
                    console.log(dados)
                    $('#atualizar').html("");
                    $('#atualizar').append(`<p>Jogo ${dados.dadosEnviados.id} atualizado com sucesso.</p>`);
                    $("#titulo").val('');
                    $("#autor").val('');
                    $("#categoria").val('');
                    $("#id").val('');
                },
                error: function (dados) {
                    console.log('Não foi possível atualizar dados.');
                },
                contentType: 'application/json',
            });
        }

    function delete_jogo(params) {
        let n = $("#input_nome" , "input_dev", "input_categoria","input_img" ).val();
            $.ajax({
            type: 'DELETE',
            url: `http://localhost:3000/livros/deletejogo/${n}`,
                success: function(user, textost, xhr){
                 if(xhr.status == 204){
                 $("#excluir").text("Jogo removido com sucesso")
            
                }
            },
         error: function(){
         alert('erro')
        },
        dataType: 'json'
    })

        }

</script>
</html>